<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚è±Ô∏è Timer de Jogos</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Timer para jogos de tabuleiro com interface intuitiva">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Timer Jogos">
    
    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .emoji {
            font-size: 3em;
            margin-bottom: 20px;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Timer display */
        .timer-display {
            font-size: 8em;
            font-weight: bold;
            color: #667eea;
            margin: 30px 0;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            line-height: 1;
        }

        .timer-display.warning {
            color: #ff6b6b;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Input de configura√ß√£o */
        .config-section {
            margin-bottom: 30px;
        }

        .config-section label {
            display: block;
            font-size: 1.2em;
            color: #555;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .config-section input {
            width: 150px;
            padding: 15px;
            font-size: 1.5em;
            border: 3px solid #667eea;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .config-section input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }

        /* Bot√µes */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 20px 40px;
            font-size: 1.5em;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-family: inherit;
            min-width: 140px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-play {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Mensagem de fim */
        .end-message {
            font-size: 2em;
            color: #ff6b6b;
            font-weight: bold;
            margin-top: 20px;
            opacity: 0;
            transition: opacity 0.5s ease;
            animation: shake 0.5s infinite;
        }

        .end-message.show {
            opacity: 1;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        /* Responsividade */
        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 2em;
            }

            .timer-display {
                font-size: 5em;
            }

            .config-section input {
                width: 120px;
                font-size: 1.3em;
            }

            button {
                padding: 18px 30px;
                font-size: 1.3em;
                min-width: 120px;
            }
        }

        @media (max-width: 400px) {
            .timer-display {
                font-size: 4em;
            }

            .button-group {
                flex-direction: column;
                align-items: stretch;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <span class="emoji">üé≤</span>
        <h1>Timer de Jogos</h1>

        <!-- Configura√ß√£o do tempo -->
        <div class="config-section">
            <label for="timeInput">Tempo (segundos):</label>
            <input 
                type="number" 
                id="timeInput" 
                min="1" 
                max="999" 
                value="60"
                placeholder="60"
            >
        </div>

        <!-- Display do timer -->
        <div class="timer-display" id="timerDisplay">60</div>

        <!-- Bot√µes de controle -->
        <div class="button-group">
            <button class="btn-play" id="playBtn">‚ñ∂Ô∏è Play</button>
            <button class="btn-reset" id="resetBtn">üîÑ Reset</button>
        </div>

        <!-- Mensagem de fim -->
        <div class="end-message" id="endMessage">‚è∞ TEMPO ESGOTADO! ‚è∞</div>
    </div>

    <script>
        // Elementos do DOM
        const timerDisplay = document.getElementById('timerDisplay');
        const timeInput = document.getElementById('timeInput');
        const playBtn = document.getElementById('playBtn');
        const resetBtn = document.getElementById('resetBtn');
        const endMessage = document.getElementById('endMessage');

        // Vari√°veis de controle
        let totalSeconds = 60;
        let remainingSeconds = 60;
        let timerInterval = null;
        let isRunning = false;

        // Criar √°udio do alarme usando Web Audio API para garantir compatibilidade
        let audioContext;
        let alarmSound;

        // Inicializar √°udio ap√≥s primeira intera√ß√£o do usu√°rio
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // iOS requer que o AudioContext seja resumido ap√≥s intera√ß√£o do usu√°rio
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                createAlarmSound();
            } else if (audioContext.state === 'suspended') {
                // Garantir que o contexto est√° ativo antes de tocar
                audioContext.resume();
            }
        }

        // Criar som de alarme usando Web Audio API
        function createAlarmSound() {
            // Criar um buffer com o som do alarme
            const duration = 1;
            const sampleRate = audioContext.sampleRate;
            const buffer = audioContext.createBuffer(1, duration * sampleRate, sampleRate);
            const data = buffer.getChannelData(0);

            // Gerar uma onda com frequ√™ncias alternadas (som de alarme)
            for (let i = 0; i < buffer.length; i++) {
                const t = i / sampleRate;
                const freq = (Math.floor(t * 4) % 2 === 0) ? 800 : 600;
                data[i] = Math.sin(2 * Math.PI * freq * t) * 0.3;
            }

            alarmSound = buffer;
        }

        // Tocar o som do alarme
        function playAlarm() {
            if (!audioContext || !alarmSound) return;
            
            // Garantir que o AudioContext est√° ativo (iOS requer isso)
            if (audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    playAlarmSound();
                });
            } else {
                playAlarmSound();
            }
        }
        
        // Fun√ß√£o auxiliar para tocar o som
        function playAlarmSound() {
            // Tocar 3 vezes
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const source = audioContext.createBufferSource();
                    source.buffer = alarmSound;
                    source.connect(audioContext.destination);
                    source.start(0);
                }, i * 1200);
            }
        }

        // Atualizar o display do timer
        function updateDisplay() {
            timerDisplay.textContent = remainingSeconds;
            
            // Adicionar classe de warning nos √∫ltimos 10 segundos
            if (remainingSeconds <= 10 && remainingSeconds > 0) {
                timerDisplay.classList.add('warning');
            } else {
                timerDisplay.classList.remove('warning');
            }
        }

        // Fun√ß√£o principal do timer
        function tick() {
            remainingSeconds--;
            updateDisplay();

            if (remainingSeconds <= 0) {
                endTimer();
            }
        }

        // Iniciar o timer
        function startTimer() {
            // Inicializar √°udio na primeira intera√ß√£o
            initAudio();

            if (isRunning) {
                // Se j√° est√° rodando, pausar
                pauseTimer();
                return;
            }

            // Atualizar o tempo total se o timer est√° no in√≠cio
            if (remainingSeconds === totalSeconds) {
                const inputValue = parseInt(timeInput.value);
                if (inputValue > 0) {
                    totalSeconds = inputValue;
                    remainingSeconds = inputValue;
                    updateDisplay();
                }
            }

            isRunning = true;
            timerInterval = setInterval(tick, 1000);
            
            // Atualizar UI dos bot√µes
            playBtn.textContent = '‚è∏Ô∏è Pausar';
            playBtn.classList.remove('btn-play');
            playBtn.classList.add('btn-pause');
            timeInput.disabled = true;
            endMessage.classList.remove('show');
        }

        // Pausar o timer
        function pauseTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            
            // Atualizar UI dos bot√µes
            playBtn.textContent = '‚ñ∂Ô∏è Play';
            playBtn.classList.remove('btn-pause');
            playBtn.classList.add('btn-play');
        }

        // Resetar o timer
        function resetTimer() {
            pauseTimer();
            
            const inputValue = parseInt(timeInput.value);
            if (inputValue > 0) {
                totalSeconds = inputValue;
                remainingSeconds = inputValue;
            } else {
                remainingSeconds = totalSeconds;
            }
            
            updateDisplay();
            timeInput.disabled = false;
            endMessage.classList.remove('show');
        }

        // Finalizar o timer
        function endTimer() {
            pauseTimer();
            remainingSeconds = 0;
            updateDisplay();
            
            // Mostrar mensagem
            endMessage.classList.add('show');
            
            // Tocar alarme
            playAlarm();
            
            // Adicionar vibra√ß√£o como feedback extra (funciona em iOS e Android)
            if ('vibrate' in navigator) {
                // Padr√£o de vibra√ß√£o: vibra, pausa, vibra, pausa, vibra
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
            
            // Habilitar input novamente
            timeInput.disabled = false;
            
            // Resetar automaticamente ap√≥s 3 segundos
            setTimeout(() => {
                if (remainingSeconds === 0) {
                    resetTimer();
                }
            }, 3000);
        }

        // Event listeners
        playBtn.addEventListener('click', startTimer);
        resetBtn.addEventListener('click', () => {
            // iOS: garantir que o contexto est√° ativo no reset tamb√©m
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            resetTimer();
        });

        // Atualizar display quando o input mudar (somente se n√£o estiver rodando)
        timeInput.addEventListener('input', () => {
            if (!isRunning) {
                const inputValue = parseInt(timeInput.value);
                if (inputValue > 0) {
                    totalSeconds = inputValue;
                    remainingSeconds = inputValue;
                    updateDisplay();
                }
            }
        });

        // Permitir Enter para iniciar
        timeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !isRunning) {
                startTimer();
            }
        });

        // Prevenir valores negativos no input
        timeInput.addEventListener('blur', () => {
            const inputValue = parseInt(timeInput.value);
            if (!inputValue || inputValue < 1) {
                timeInput.value = totalSeconds;
            }
        });

        // Inicializa√ß√£o
        updateDisplay();
        
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registrado com sucesso:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Falha ao registrar Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
